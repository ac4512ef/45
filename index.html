<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Faktoriális Fantázia — n!</title>
<style>
  :root{
    --bg1:#0b1020;
    --bg2:#1a1940;
    --glow:#7fffd4;
    --accent:#a0e9ff;
    --hot:#ff9cf0;
    --lite:#d9f8ff;
    --glass: rgba(255,255,255,0.08);
    --glass-stroke: rgba(255,255,255,0.15);
  }
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;font-family:system-ui,Segoe UI,Roboto,Ubuntu,Helvetica,Arial,sans-serif;background:radial-gradient(1200px 700px at 70% 20%, #2b2a66 0%, transparent 60%), radial-gradient(900px 600px at 20% 80%, #2b2a66 0%, transparent 60%), linear-gradient(180deg,var(--bg2),var(--bg1));color:#f2f7ff;overflow-x:hidden}
  
  /* Twinkling starfield */
  .stars, .stars2, .stars3{
    position:fixed;inset:0;pointer-events:none;z-index:0;
    background-repeat:repeat;
    background-size:400px 400px;
    animation: twinkle 12s linear infinite;
  }
  .stars{background-image: radial-gradient(2px 2px at 20px 30px,#ffffffaa,transparent 50%),
                                  radial-gradient(1px 1px at 120px 80px,#ffffff66,transparent 50%),
                                  radial-gradient(1px 1px at 200px 140px,#ffffff99,transparent 50%),
                                  radial-gradient(2px 2px at 320px 200px,#ffffffaa,transparent 50%);}
  .stars2{background-image: radial-gradient(1px 1px at 60px 90px,#ffffff55,transparent 50%),
                                   radial-gradient(2px 2px at 180px 30px,#ffffff88,transparent 50%),
                                   radial-gradient(1px 1px at 260px 310px,#ffffff66,transparent 50%); 
           animation-duration: 18s; opacity:.8}
  .stars3{background-image: radial-gradient(1px 1px at 90px 40px,#ffffff55,transparent 50%),
                                   radial-gradient(1px 1px at 300px 120px,#ffffff88,transparent 50%);
           animation-duration: 26s; opacity:.6}
  @keyframes twinkle{0%{transform:translateY(0)}100%{transform:translateY(-200px)}}
  
  .wrap{position:relative;z-index:1;display:flex;min-height:100%;align-items:center;justify-content:center;padding:24px}
  .card{
    width:min(980px, 100%);
    background:linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
    border:1px solid var(--glass-stroke);
    border-radius:24px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.45), inset 0 0 80px rgba(160,233,255,0.05);
    padding: clamp(18px, 3.5vw, 38px);
    backdrop-filter: blur(8px);
  }
  h1{
    margin:0 0 8px 0;
    font-size: clamp(28px, 5vw, 44px);
    letter-spacing: 0.5px;
    text-shadow: 0 0 22px rgba(127,255,212,0.45);
  }
  .sub{
    margin:0 0 18px 0;
    color:#cdeaff;
    opacity:.85;
  }
  .grid{
    display:grid;
    grid-template-columns: 1.2fr 1fr;
    gap: clamp(14px, 2.8vw, 28px);
  }
  @media (max-width: 900px){
    .grid{grid-template-columns: 1fr;}
  }
  .panel{
    background:var(--glass);
    border:1px solid var(--glass-stroke);
    border-radius:18px;
    padding: clamp(14px, 2.2vw, 20px);
  }
  .bigN{
    font-size: clamp(36px, 7vw, 72px);
    font-weight: 800;
    line-height: 1;
    letter-spacing: -1px;
    display:flex;align-items:baseline;gap:.25em;
  }
  .bigN .bang{
    filter: drop-shadow(0 0 18px rgba(160,233,255,.6));
    color: var(--accent);
  }
  .factRow{
    margin:14px 0 10px 0;
    font-variant-numeric: tabular-nums;
    word-break: break-word;
  }
  .value{
    font-size: clamp(18px, 3.5vw, 28px);
    font-weight:600;
    color:var(--lite);
    text-shadow: 0 0 16px rgba(160,233,255,0.25);
  }
  .small{
    font-size: .9rem;opacity:.85
  }
  .sliderRow{display:flex;align-items:center;gap:12px;margin-top:10px}
  input[type="range"]{
    -webkit-appearance:none;appearance:none;width:100%;height:8px;border-radius:999px;background:#ffffff22;outline:none
  }
  input[type="range"]::-webkit-slider-thumb{
    -webkit-appearance:none;appearance:none;width:22px;height:22px;border-radius:50%;
    background: radial-gradient(12px 12px at 40% 40%, var(--glow), #7bc9ff);
    border:2px solid #ffffffaa; box-shadow:0 6px 16px rgba(0,0,0,.45), 0 0 24px rgba(127,255,212,.75);
    cursor:pointer
  }
  .hint{opacity:.8;margin-top:10px}
  .svgWrap{
    aspect-ratio: 1.3/1;
    width:100%;
    background: radial-gradient(650px 420px at 70% 30%, rgba(160,233,255,0.12), transparent 60%),
                radial-gradient(500px 360px at 20% 80%, rgba(255,156,240,0.14), transparent 60%);
    border:1px solid var(--glass-stroke); border-radius:16px; overflow:hidden;
  }
  .legend{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
  .tag{padding:6px 10px;border-radius:999px;background:#ffffff18;border:1px solid var(--glass-stroke);font-size:.9rem}
  footer{margin-top:18px;opacity:.7;font-size:.9rem}
</style>
</head>
<body>
<div class="stars"></div><div class="stars2"></div><div class="stars3"></div>
<div class="wrap">
  <div class="card">
    <h1>Faktoriális Fantázia <span aria-hidden="true">—</span> <span id="titleN">5</span><span>!</span></h1>
    <p class="sub">Egy <em>fantasy</em> hangulatú vizualizáció arról, hogy mit jelent az <strong>n!</strong> — a lehetőségek robbanásszerű szaporodása.</p>
    
    <div class="grid">
      <section class="panel">
        <div class="bigN"><span id="bigN">5</span><span class="bang">!</span></div>
        <div class="factRow small" id="formula">5 × 4 × 3 × 2 × 1</div>
        <div class="value" id="value">120</div>
        <div class="sliderRow">
          <label for="n" class="small">n =</label>
          <input id="n" type="range" min="1" max="12" step="1" value="5" />
          <output id="outN">5</output>
        </div>
        <p class="hint small">Húzd a csúszkát, és nézd meg, hogyan nő a <strong>lehetséges sorrendek</strong> száma (n!), miközben a diagram újrarendezi a pontokat.</p>
        <div class="legend">
          <span class="tag">n pont egy körön</span>
          <span class="tag">minden permutáció: n!</span>
          <span class="tag">kombinatorikai „kozmológia”</span>
        </div>
      </section>
      
      <section class="panel">
        <div class="svgWrap">
          <svg id="scene" viewBox="0 0 1000 770" xmlns="http://www.w3.org/2000/svg" aria-label="Faktoriális fantázia jelenet">
            <defs>
              <radialGradient id="glowGrad" cx="50%" cy="50%" r="50%">
                <stop offset="0%" stop-color="#a0e9ff" stop-opacity="0.95"/>
                <stop offset="60%" stop-color="#7fffd4" stop-opacity="0.35"/>
                <stop offset="100%" stop-color="#7fffd4" stop-opacity="0"/>
              </radialGradient>
              <filter id="soft" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="18"/>
              </filter>
              <filter id="soft2" x="-50%" y="-50%" width="200%" height="200%">
                <feGaussianBlur stdDeviation="8"/>
              </filter>
            </defs>
            
            <!-- Cosmic sigil -->
            <circle cx="500" cy="385" r="150" fill="url(#glowGrad)" filter="url(#soft)"/>
            <g id="ring">
              <circle cx="500" cy="385" r="210" fill="none" stroke="#a0e9ff" stroke-opacity=".35" stroke-width="2"/>
              <circle cx="500" cy="385" r="270" fill="none" stroke="#ff9cf0" stroke-opacity=".25" stroke-width="2"/>
              <circle cx="500" cy="385" r="330" fill="none" stroke="#a0e9ff" stroke-opacity=".18" stroke-width="2"/>
            </g>
            
            <!-- Magic title -->
            <g id="sigil" filter="url(#soft2)">
              <text x="500" y="400" text-anchor="middle" font-size="120" font-weight="800" fill="#d9f8ff">n!</text>
            </g>
            
            <!-- Points + links will be injected here -->
            <g id="links"></g>
            <g id="points"></g>
          </svg>
        </div>
      </section>
    </div>
    
    <footer>
      Tipp: az <strong>n!</strong> a „hányféleképpen rendezhetünk sorba n különböző elemet” kérdésre válaszol. Például 10! = 3 628 800, ami már egy galaxisnyi lehetőség.
    </footer>
  </div>
</div>

<script>
  const nSlider = document.getElementById('n');
  const outN = document.getElementById('outN');
  const titleN = document.getElementById('titleN');
  const bigN = document.getElementById('bigN');
  const formula = document.getElementById('formula');
  const value = document.getElementById('value');
  const svg = document.getElementById('scene');
  const gPoints = document.getElementById('points');
  const gLinks = document.getElementById('links');

  function factorialBigInt(n){
    let r = 1n;
    for(let i=2n;i<=BigInt(n);i++) r *= i;
    return r;
  }
  function groupBigInt(x){
    const s = x.toString();
    return s.replace(/\B(?=(\d{3})+(?!\d))/g, '\u202F'); // thin-space
  }
  function formulaText(n){
    let arr=[];
    for(let i=n;i>=1;i--) arr.push(i);
    return arr.join(' × ');
  }

  function layout(n){
    // clear
    gPoints.innerHTML='';
    gLinks.innerHTML='';
    const cx = 500, cy = 385;
    const R = 300;
    const dots = [];
    for(let i=0;i<n;i++){
      const ang = (i / n) * Math.PI*2 - Math.PI/2;
      const x = cx + Math.cos(ang)*R;
      const y = cy + Math.sin(ang)*R;
      dots.push({x,y, i});
    }
    // draw subtle permutation chords: connect i -> (i+1) mod n repeatedly to hint cycles
    for(let k=0;k<n-1;k++){
      const a = dots[k];
      const b = dots[(k+1)%n];
      const path = document.createElementNS('http://www.w3.org/2000/svg','path');
      const mx = (a.x+b.x)/2, my = (a.y+b.y)/2;
      const dx = (mx - 500)*0.18, dy = (my - 385)*0.18; // curve toward center
      const d = `M ${a.x},${a.y} Q ${mx-dx},${my-dy} ${b.x},${b.y}`;
      path.setAttribute('d', d);
      path.setAttribute('fill', 'none');
      path.setAttribute('stroke', k%2? '#a0e9ff':'#ff9cf0');
      path.setAttribute('stroke-opacity', 0.22);
      path.setAttribute('stroke-width', 2);
      gLinks.appendChild(path);
    }
    // draw points
    dots.forEach((p, idx)=>{
      const g = document.createElementNS('http://www.w3.org/2000/svg','g');
      const c1 = document.createElementNS('http://www.w3.org/2000/svg','circle');
      c1.setAttribute('cx', p.x); c1.setAttribute('cy', p.y); c1.setAttribute('r', 12);
      c1.setAttribute('fill', '#ffffff'); c1.setAttribute('fill-opacity', .95);
      const cGlow = document.createElementNS('http://www.w3.org/2000/svg','circle');
      cGlow.setAttribute('cx', p.x); cGlow.setAttribute('cy', p.y); cGlow.setAttribute('r', 22);
      cGlow.setAttribute('fill', 'url(#glowGrad)'); cGlow.setAttribute('opacity', .8);
      const label = document.createElementNS('http://www.w3.org/2000/svg','text');
      label.setAttribute('x', p.x); label.setAttribute('y', p.y+5);
      label.setAttribute('text-anchor','middle');
      label.setAttribute('font-size','16');
      label.setAttribute('font-weight','700');
      label.setAttribute('fill','#0b1020');
      label.textContent = (idx+1).toString();
      g.appendChild(cGlow); g.appendChild(c1); g.appendChild(label);
      gPoints.appendChild(g);
    });
    // pulse n!
    const sigil = svg.querySelector('#sigil text');
    sigil.textContent = `${n}!`;
    sigil.animate([{transform:'scale(0.96)'},{transform:'scale(1)'}],{duration:220, easing:'ease-out'});
  }

  function update(n){
    outN.textContent = n;
    titleN.textContent = n;
    bigN.textContent = n;
    formula.textContent = formulaText(n);
    const val = factorialBigInt(n);
    value.textContent = groupBigInt(val);
    layout(n);
    // brighten stars slightly with n
    const intensity = Math.min(1, 0.4 + n/20);
    document.querySelectorAll('.stars,.stars2,.stars3').forEach(el=>el.style.opacity = intensity);
  }

  nSlider.addEventListener('input', (e)=> update(parseInt(e.target.value,10)));
  // init
  update(parseInt(nSlider.value,10));
</script>
</body>
</html>
